# README.md への追加提案 (差分)

このファイルは、現在の `README.md` に記載されていない新しいサービスに関する説明をまとめたものです。
以下の内容を `README.md` の適切な箇所に統合することを推奨します。

---

## 1. 「プロジェクト構造」セクションの更新案

`Services/` 配下のリストを以下のように更新します。`WeaponOmodExtractor` と `LinkCacheHelper` が追加されています。

```
Services/                        # サービス層
├── Interfaces/
│   ├── IOrchestrator.cs
│   ├── IWeaponsService.cs
│   ├── IRobCoIniGenerator.cs
│   ├── ILoadOrderService.cs
│   ├── IConfigService.cs
│   └── IWeaponOmodExtractor.cs  # <--- 追加
└── Implementations/
    ├── OrchestratorService.cs
    ├── WeaponsService.cs
    ├── RobCoIniGenerator.cs
    ├── LoadOrderService.cs
    ├── ConfigService.cs
    ├── WeaponOmodExtractor.cs   # <--- 追加
    └── LinkCacheHelper.cs       # <--- 追加
```

---

## 2. 「機能」または「アーキテクチャ」セクションへの追加説明案

既存のサービス説明に加えて、以下の新しいサービスに関する説明を追加します。

### 追加された高度なサービス

#### WeaponOmodExtractor
- **役割**: 武器の改造（OMOD）情報を抽出し、改造によって弾薬が変更されるケースを検出する、高度な解析サービスです。
- **詳細**: 標準の武器レコード（`WEAP`）が持つ弾薬情報だけでなく、武器に取り付けられるレシーバーやマガジンといった改造部品が弾薬の種類を変更する場合、それを検知してパッチの候補とします。これにより、より複雑な武器MODに対しても正確なパッチ生成が可能になります。

#### LinkCacheHelper
- **役割**: `Mutagen`ライブラリのデータ解決機能を補助する、内部的なヘルパークラスです。
- **詳細**: このサービスは、MODデータ間の複雑な関連付け（FormKeyによるリンク）を安全かつ効率的に解決するために使用されます。特に `WeaponOmodExtractor` のようなリフレクションを多用する高度な解析処理を安定させるための重要な基盤部品ですが、アプリケーションの直接的な機能としてユーザーが意識する必要はありません。

---

## 3. 現在のプロジェクトにおける課題・問題点 (追記案)

プロジェクトの現状を正確に把握するため、以下の課題を `README.md` の「注意事項」や、新設する「既知の課題」セクションに追記することを推奨します。

### ドキュメントと実装の乖離
- **問題**: `README.md` が `WeaponOmodExtractor` のような重要な機能追加に追いついておらず、情報が陳腐化しています。
- **影響**: 新しい開発者がプロジェクトの全体像や現在の能力を正確に把握することを困難にします。継続的なドキュメントの更新が必要です。

### 高度なMOD解析の複雑性と限界
- **問題**: OMODの解析機能は強力ですが、`Mutagen`ライブラリのバージョン間の差異を吸収するためにリフレクション（C#の高度な機能）に強く依存しています。そのため、解析は常にベストエフォート（最善努力）となります。
- **影響**: 特に大規模で複雑なMOD（例: `Dank_ECO.esp`）を対象とした場合、改造による弾薬変更の誤検出や検出漏れが発生する可能性があります。自動解析の結果は万能ではなく、最終的にはユーザーによる確認や手動調整が必要になる場合があります。

### エラーハンドリングとデバッグの課題
- **問題**: コードベース、特に `WeaponOmodExtractor` 内には、多くの例外をログに出力しつつも処理を続行する（握りつぶす）箇所が散見されます (`Suppressed exception (empty catch)` など)。
- **影響**: これにより、アプリケーションが予期せぬ状態で動作を続ける可能性があり、問題が発生した際の根本的な原因究明が困難になるリスクがあります。より堅牢なエラーハンドリングと、ユーザーへの明確なフィードバックが今後の課題です。